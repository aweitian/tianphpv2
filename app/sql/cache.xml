<?xml version="1.0" encoding="UTF-8"?>
<sql>
	<disease>
		<create>
			CREATE TABLE `cache_disease` (
			  `pid` int(11) DEFAULT NULL,
			  `pd` varchar(1024) DEFAULT NULL,
			  `mid` int(11) DEFAULT NULL,
			  `md` varchar(1024) DEFAULT NULL
			) ENGINE=MyISAM DEFAULT CHARSET=utf8
		
		</create>
		
		<update>
			INSERT INTO `cache_disease` (`pid`,`pd`,`mid`,`md`)
		    SELECT 
			`data_attr_data`.`pid`,`p_data_attr_data`.`data`,
			`data_attr_data`.`sid`,`data_attr_data`.`data`
		    FROM `data_attr_data`
		    LEFT JOIN `data_attr_data` `p_data_attr_data` ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
		    
		     WHERE `data_attr_data`.`metaid` = 2 AND `data_attr_data`.`grp` = 1;		
		
		</update>
		<all>
			SELECT
			  `pid`,
			  `pd`,
			  `mid`,
			  `md`
			FROM `cache_disease`
		</all>
		<query_on_raw>
		 SELECT 
			`data_attr_data`.`pid` as `pid`,`p_data_attr_data`.`data` as `pd`,
			`data_attr_data`.`sid` as `mid`,`data_attr_data`.`data` as `md`
		    FROM `data_attr_data`
		    LEFT JOIN `data_attr_data` `p_data_attr_data` ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
		    
		     WHERE `data_attr_data`.`metaid` = 2 AND `data_attr_data`.`grp` = 1;		
		
		
		</query_on_raw>
	</disease>

	<artical_disease>
		<create>
			CREATE TABLE `cache_artical_disease` (
			  `aid` int(11) DEFAULT NULL,
			  `title` varchar(1024) DEFAULT NULL,
			  `pid` int(11) DEFAULT NULL,
			  `pd` varchar(1024) DEFAULT NULL,
			  `mid` int(11) DEFAULT NULL,
			  `md` varbinary(1024) DEFAULT NULL
			) ENGINE=MyISAM DEFAULT CHARSET=utf8
		</create>
		<update>
			INSERT INTO `cache_artical_disease` (`aid`,`title`,`pid`,`pd`,`mid`,`md`)

			SELECT 
				`data_artical`.`sid`,`data_artical`.`title`,
				`data_attr_data`.`pid` AS `pid`,`p_data_attr_data`.`data`,
				`data_attr_data`.`sid`,`data_attr_data`.`data`
			FROM `data_attr_data`
			LEFT JOIN `data_attr_data` `p_data_attr_data` ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
			RIGHT JOIN `data_artical_ext`
			ON `data_artical_ext`.`did` =  `data_attr_data`.`sid`    
			LEFT JOIN `data_artical`
			ON `data_artical`.`sid` = `data_artical_ext`.`aid`
		</update>
		<all>
			SELECT
			  `aid`,
			  `title`,
			  `pid`,
			  `pd`,
			  `mid`,
			  `md`
			FROM `cache_artical_disease`
		</all>
		
		<query_on_raw_count>
			SELECT 
				COUNT(`data_artical`.`sid`) as `count`
			FROM `data_attr_data`
			LEFT JOIN `data_attr_data` `p_data_attr_data` 
			ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
			RIGHT JOIN `data_artical_ext`
			ON `data_artical_ext`.`did` =  `data_attr_data`.`sid`    
			LEFT JOIN `data_artical`
			ON `data_artical`.`sid` = `data_artical_ext`.`aid`
		</query_on_raw_count>
		<query_on_raw>
			SELECT 
				`data_artical`.`sid` as `aid`,`data_artical`.`title` as `title`,
				`data_artical`.`date` as `date`,
				`data_attr_data`.`pid` AS `pid`,`p_data_attr_data`.`data` as `pd`,
				`data_attr_data`.`sid` as `mid`,`data_attr_data`.`data` as `md`
			FROM `data_attr_data`
			LEFT JOIN `data_attr_data` `p_data_attr_data` 
			ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
			RIGHT JOIN `data_artical_ext`
			ON `data_artical_ext`.`did` =  `data_attr_data`.`sid`    
			LEFT JOIN `data_artical`
			ON `data_artical`.`sid` = `data_artical_ext`.`aid`
			@WHERECLAUSE
			ORDER BY `aid` ASC
			LIMIT :offset,:length
		</query_on_raw>
		<where_clause_dc>
			`data_attr_data`.`pid` = :dcid
		</where_clause_dc>
		<where_clause_di>
			`data_attr_data`.`sid` = :diid
		</where_clause_di>
		<where_clause_title>
			`data_artical`.`title` like CONCAT('%',:title,'%')
		</where_clause_title>
		
		
		<reldis_homeless>
			<count>
				SELECT COUNT(`data_artical`.`sid`) as `count`
				FROM `data_artical`
				WHERE
				`data_artical`.`sid`
				NOT IN (SELECT `aid` FROM `data_artical_ext`)
			</count>
			<query>
				SELECT `data_artical`.`sid`,`data_artical`.`title`,`data_artical`.`date`
				FROM `data_artical`
				WHERE
				`data_artical`.`sid`
				NOT IN (SELECT `aid` FROM `data_artical_ext`)
				LIMIT :offset,:length 
			</query>
		</reldis_homeless>
		
	</artical_disease>

</sql>