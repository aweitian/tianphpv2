<?xml version="1.0" encoding="UTF-8"?>
<ui_disease>
	<tree2table>
	 	SELECT 
			`data_attr_data`.`pid` as `pid`,`p_data_attr_data`.`data` as `pd`,
			`data_attr_data`.`sid` as `mid`,`data_attr_data`.`data` as `md`,
			`data_attr_data`.`key` as `url`
		    FROM `data_attr_data`
		    LEFT JOIN `data_attr_data` `p_data_attr_data` 
		    	ON `data_attr_data`.`pid` = `p_data_attr_data`.`sid`
		     WHERE `data_attr_data`.`metaid` = 2 AND `data_attr_data`.`grp` = 1;		
	</tree2table>

	<!-- 获取DISEASE ROW INFO BY URL KEY -->
	<row_disease_url>
		SELECT * FROM `data_attr_data`
		WHERE 
		`key` = :key AND
		`data_attr_data`.`grp` = 1;	
	</row_disease_url>
	
	<!-- 根据病种Id获取疾病知识的文章 -->
	<ArticalTag7>
		<!-- 两条SQL返回结果一样，数据量达到一定程度时，BAK的效率可能更好 -->
		<bak>
			SELECT 
			`data_artical`.sid,
			`data_artical`.`thumb`,`data_artical`.`title`,`data_artical`.`desc`
			FROM (SELECT `data_artical_tags`.`aid`,`data_artical_tags`.`tid` FROM `data_artical_tags` 
			WHERE `data_artical_tags`.`tid` = 7) AS `data_artical_tags`
			LEFT JOIN data_artical_dis ON `data_artical_tags`.`aid` = `data_artical_dis`.`aid`
			LEFT JOIN `data_artical` ON `data_artical_tags`.`aid` = `data_artical`.`sid`
			WHERE  `data_artical_dis`.`did` = :did		
		</bak>
		<main>
			SELECT 
				`data_artical`.sid,
				`data_artical`.`thumb`,`data_artical`.`title`,`data_artical`.`desc`
				 FROM `data_artical_tags` 
				LEFT JOIN data_artical_dis ON `data_artical_tags`.`aid` = `data_artical_dis`.`aid`
				LEFT JOIN `data_artical` ON `data_artical_tags`.`aid` = `data_artical`.`sid`
				WHERE `data_artical_tags`.`tid` = 7
				AND `data_artical_dis`.`did` = :did
		</main>
	</ArticalTag7>
	
	<!-- 根据病种Id获取问答和回答(医生回答最多只获取一条) -->
	<getAskAnswerByDid>
		<ask>
			SELECT 
				`data_ask`.`sid`,
				`data_ask`.`title`,
				`data_ask`.`date`,
				`data_ask`.`dod`,
				FROM `data_ask`
				ORDER BY `data_ask`.`sid` DESC
			LIMIT 0,:length
		</ask>
		
		<answer>
			SELECT 
				`data_ask_append`.`content`
				FROM `data_ask_append`
				WHERE `data_ask_append`.`askid` = :askid
				AND `data_ask_append`.`role` = 'doctor'
				LIMIT 0,1
		</answer>
		
		
		<!-- 
		SELECT 
		`data_ask`.`sid`,
		`data_ask`.`title`,
		`data_ask`.`date`,
		`data_ask`.`dod`,
		`data_doctor`.`avatar`,
		`data_doctor`.`name`,
		`data_doctor`.`id`,
		`data_ask_append`.`content`
		FROM `data_ask`
		LEFT JOIN `data_ask_append` ON `data_ask_append`.`askid` = `data_ask`.`sid`
		LEFT JOIN `data_doctor` ON `data_doctor`.`sid` = `data_ask`.`dod`
		WHERE `data_ask`.`did` = :did
		AND `data_ask_append`.`role` = 'doctor'
		GROUP BY `data_ask`.`sid`
		ORDER BY `data_ask`.`sid` DESC
		LIMIT 0,:length
		-->
		
	</getAskAnswerByDid>

</ui_disease>